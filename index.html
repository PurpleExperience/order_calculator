<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞</title>
    <style>
        :root {
            /* –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) */
            --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --card-bg: white;
            --text-primary: #333;
            --text-secondary: #666;
            --header-gradient: linear-gradient(135deg, #ff6b6b, #ee5a24);
            --summary-gradient: linear-gradient(135deg, #667eea, #764ba2);
            --input-bg: white;
            --input-border: #e1e8ed;
            --input-focus: #667eea;
            --section-bg: #f8f9fa;
            --checkbox-bg: rgba(245, 247, 250, 0.8);
            --checkbox-hover: #e6f0ff;
            --checkbox-border: #e1e8ed;
            --person-summary-bg: rgba(255,255,255,0.1);
            --person-summary-alt-bg: rgba(255,255,255,0.15);
            --item-card-bg: #ffffff;
            --item-card-alt-bg: #f8f9fa;
            --item-card-border: #e1e8ed;
            --error-bg: #f8d7da;
            --error-border: #f5c6cb;
            --error-text: #dc3545;
            --shadow: rgba(0,0,0,0.1);
            --shadow-hover: rgba(0,0,0,0.15);
            --copy-btn-bg: #28a745;
            --copy-btn-hover: #218838;
            --copy-success-bg: #d4edda;
            --copy-success-border: #c3e6cb;
            --copy-success-text: #155724;
        }

        /* –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ */
        @media (prefers-color-scheme: dark) {
            :root {
                --bg-gradient: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
                --card-bg: #2d3748;
                --text-primary: #e2e8f0;
                --text-secondary: #a0aec0;
                --header-gradient: linear-gradient(135deg, #2F4F4F, #2F4F4F);
                --summary-gradient: linear-gradient(135deg, #4c51bf, #553c9a);
                --input-bg: #4a5568;
                --input-border: #718096;
                --input-focus: #805ad5;
                --section-bg: #374151;
                --checkbox-bg: rgba(74, 85, 104, 0.8);
                --checkbox-hover: rgba(128, 90, 213, 0.2);
                --checkbox-border: #718096;
                --person-summary-bg: rgba(255,255,255,0.05);
                --person-summary-alt-bg: rgba(255,255,255,0.1);
                --item-card-bg: #374151;
                --item-card-alt-bg: #4a5568;
                --item-card-border: #718096;
                --error-bg: rgba(220, 53, 69, 0.2);
                --error-border: rgba(220, 53, 69, 0.3);
                --error-text: #f56565;
                --shadow: rgba(0,0,0,0.3);
                --shadow-hover: rgba(0,0,0,0.4);
                --copy-btn-bg: #38a169;
                --copy-btn-hover: #2f855a;
                --copy-success-bg: rgba(56, 161, 105, 0.2);
                --copy-success-border: rgba(56, 161, 105, 0.3);
                --copy-success-text: #68d391;
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-gradient);
            min-height: 100vh;
            padding: 20px;
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: var(--card-bg);
            border-radius: 20px;
            box-shadow: 0 20px 40px var(--shadow);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .header {
            background: var(--header-gradient);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .content {
            padding: 30px;
        }

        .input-section {
            margin-bottom: 30px;
        }

        .input-section h2 {
            color: var(--text-primary);
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        textarea {
            width: 100%;
            height: 150px;
            padding: 15px;
            border: 2px solid var(--input-border);
            border-radius: 12px;
            font-size: 14px;
            font-family: monospace;
            resize: vertical;
            transition: border-color 0.3s ease, background-color 0.3s ease, color 0.3s ease;
            background: var(--input-bg);
            color: var(--text-primary);
        }

        textarea:focus {
            outline: none;
            border-color: var(--input-focus);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        textarea::placeholder {
            color: var(--text-secondary);
        }

        .parse-btn {
            background: var(--summary-gradient);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 15px;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .parse-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        .people-section {
            margin: 30px 0;
            padding: 20px;
            background: var(--section-bg);
            border-radius: 12px;
            transition: background-color 0.3s ease;
        }

        .people-input {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .people-input input {
            flex: 1;
            min-width: 200px;
            padding: 10px 15px;
            border: 2px solid var(--input-border);
            border-radius: 8px;
            font-size: 14px;
            background: var(--input-bg);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .people-input input::placeholder {
            color: var(--text-secondary);
        }

        .add-person-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .add-person-btn:hover {
            background: #218838;
        }

        .people-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .person-tag {
            background: var(--header-gradient);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .remove-person {
            background: rgba(255,255,255,0.3);
            border: none;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            cursor: pointer;
            font-size: 12px;
        }

        .items-section {
            margin-top: 30px;
        }

        .item-card {
            border: 2px solid var(--item-card-border);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            transition: border-color 0.3s ease, transform 0.2s ease, background-color 0.3s ease;
        }

        .item-card:hover {
            border-color: var(--input-focus);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px var(--shadow-hover);
        }

        /* –ß–µ—Ä–µ–¥—É—é—â–∏–µ—Å—è —Ü–≤–µ—Ç–∞ –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å–ø–∏—Å–∫–∞ */
        .item-card:nth-child(odd) {
            background: var(--item-card-bg);
        }

        .item-card:nth-child(even) {
            background: var(--item-card-alt-bg);
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .item-info {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
            min-width: 250px;
        }

        .item-image {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 24px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
            flex-shrink: 0;
            box-shadow: 0 4px 8px var(--shadow);
        }

        .item-details {
            flex: 1;
        }

        .item-name {
            font-weight: bold;
            color: var(--text-primary);
            font-size: 1.1em;
            margin-bottom: 4px;
            line-height: 1.3;
        }

        .item-price {
            color: #28a745;
            font-weight: bold;
            font-size: 1.2em;
            align-self: flex-start;
        }

        @media (prefers-color-scheme: dark) {
            .item-price {
                color: #68d391;
            }
        }

        .person-checkboxes {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }

        .checkbox-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 8px;
            transition: all 0.3s ease;
            background: var(--checkbox-bg);
            border: 1px solid var(--checkbox-border);
        }

        .checkbox-wrapper:hover {
            background: var(--checkbox-hover);
            border-color: var(--input-focus);
            transform: translateY(-2px);
            box-shadow: 0 2px 5px var(--shadow);
        }

        .checkbox-wrapper input[type="checkbox"] {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border: 2px solid var(--input-focus);
            border-radius: 4px;
            outline: none;
            cursor: pointer;
            position: relative;
            transition: all 0.2s ease;
        }

        .checkbox-wrapper input[type="checkbox"]:checked {
            background-color: var(--input-focus);
            border-color: var(--input-focus);
        }

        .checkbox-wrapper input[type="checkbox"]:checked::after {
            content: "‚úì";
            position: absolute;
            color: white;
            font-size: 14px;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        .checkbox-wrapper input[type="checkbox"]:focus {
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3);
        }
        
        .checkbox-wrapper.checked {
            background: var(--checkbox-hover);
            border-color: var(--input-focus);
            font-weight: 500;
        }

        .summary {
            margin-top: 40px;
            padding: 25px;
            background: var(--summary-gradient);
            border-radius: 15px;
            color: white;
            position: relative;
        }

        .summary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .summary h2 {
            font-size: 1.8em;
        }

        .copy-btn {
            background: var(--copy-btn-bg);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .copy-btn:hover {
            background: var(--copy-btn-hover);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .copy-btn:active {
            transform: translateY(0);
        }

        .copy-btn.copied {
            background: var(--copy-btn-bg);
            animation: copySuccess 0.6s ease;
        }

        @keyframes copySuccess {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .copy-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--copy-success-bg);
            color: var(--copy-success-text);
            border: 1px solid var(--copy-success-border);
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px var(--shadow);
            z-index: 1000;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
        }

        .copy-notification.show {
            opacity: 1;
            transform: translateX(0);
        }

        .person-summary {
            background: var(--person-summary-bg);
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        /* –ß–µ—Ä–µ–¥—É—é—â–∏–µ—Å—è —Ü–≤–µ—Ç–∞ –¥–ª—è –∏—Ç–æ–≥–æ–≤—ã—Ö –±–ª–æ–∫–æ–≤ */
        .person-summary:nth-child(odd) {
            background: var(--person-summary-bg);
        }

        .person-summary:nth-child(even) {
            background: var(--person-summary-alt-bg);
        }

        .person-name {
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        .person-items {
            margin-bottom: 10px;
            font-size: 0.9em;
            opacity: 0.9;
        }

        .person-total {
            font-weight: bold;
            font-size: 1.1em;
            text-align: right;
        }

        .error {
            color: var(--error-text);
            background: var(--error-bg);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px solid var(--error-border);
            transition: all 0.3s ease;
        }

        .hidden {
            display: none;
        }
		
		.copy-icon {
			width: 20px;
			height: 20px;
			cursor: pointer;
			margin-left: 10px;
			transition: all 0.2s ease;
			fill: currentColor;
		}

		.copy-icon:hover {
			transform: scale(1.1);
			opacity: 0.8;
		}
		

        /* –î–æ–±–∞–≤–∏–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ç–µ–º—ã –≤ –∑–∞–≥–æ–ª–æ–≤–æ–∫ */
        .theme-indicator {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            border-radius: 20px;
            padding: 8px 15px;
            font-size: 0.9em;
            backdrop-filter: blur(10px);
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            
            .content {
                padding: 20px;
            }
            
            .people-input {
                flex-direction: column;
            }
            
            .people-input input {
                min-width: auto;
            }

            .item-header {
                flex-direction: column;
                align-items: stretch;
            }

            .item-info {
                min-width: auto;
            }

            .item-price {
                align-self: flex-end;
                margin-top: 10px;
            }

            .theme-indicator {
                position: static;
                margin-top: 15px;
                display: inline-block;
            }

            .summary-header {
                flex-direction: column;
                align-items: stretch;
                text-align: center;
            }

            .copy-notification {
                right: 10px;
                left: 10px;
                transform: translateY(-100%);
            }

            .copy-notification.show {
                transform: translateY(0);
            }
        }

        /* –ü–ª–∞–≤–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏ —Å–º–µ–Ω–µ —Ç–µ–º—ã */
        * {
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="theme-indicator" id="themeIndicator">üåô –ê–≤—Ç–æ-—Ç–µ–º–∞</div>
            <h1>üçï –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞</h1>
            <p>–õ–µ–≥–∫–æ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ —Å—á–µ—Ç –º–µ–∂–¥—É –¥—Ä—É–∑—å—è–º–∏</p>
        </div>
        
        <div class="content">
            <div class="input-section">
                <h2>üìù –í—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç –∑–∞–∫–∞–∑–∞(–Ø–Ω–¥–µ–∫—Å–ï–¥–∞)</h2>
                <textarea id="orderText" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ —Ç–µ–∫—Å—Ç –∑–∞–∫–∞–∑–∞, –Ω–∞—á–∏–Ω–∞—é—â–∏–π—Å—è —Å '–°–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞' –∏ –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—â–∏–π—Å—è '–ò—Ç–æ–≥–æ XXX ‚ÇΩ'..."></textarea>
                <button class="parse-btn" onclick="parseOrder()">–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –∑–∞–∫–∞–∑</button>
                <div id="error" class="error hidden"></div>
            </div>

            <div id="peopleSection" class="people-section">
                <h2>üë• –£—á–∞—Å—Ç–Ω–∏–∫–∏</h2>
                <div class="people-input">
                    <input type="text" id="personName" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è —É—á–∞—Å—Ç–Ω–∏–∫–∞..." onkeypress="handlePersonKeyPress(event)">
                    <button class="add-person-btn" onclick="addPerson()">–î–æ–±–∞–≤–∏—Ç—å</button>
                </div>
                <div id="peopleList" class="people-list"></div>
            </div>

            <div id="itemsSection" class="items-section hidden">
                <h2>üçî –í—ã–±–µ—Ä–∏—Ç–µ, –∫—Ç–æ —á—Ç–æ –∑–∞–∫–∞–∑–∞–ª</h2>
                <div id="itemsList"></div>
            </div>

            <div id="summary" class="summary hidden">
					<div class="summary-header">
						<div style="display: flex; align-items: center; gap: 10px;">
							<h2>üí∞ –ò—Ç–æ–≥–æ–≤—ã–π —Ä–∞—Å—á–µ—Ç</h2>
							<svg class="copy-icon" onclick="copySummaryToClipboard()" viewBox="0 0 24 24">
								<path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/>
							</svg>
						</div>
					</div>
                <div id="summaryContent"></div>
            </div>
        </div>
    </div>

    <div id="copyNotification" class="copy-notification">
        ‚úÖ –†–∞—Å—á–µ—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω
    </div>

    <script>
        let orderData = {
            items: [],
            deliveryCost: 0,
            serviceFee: 0,
            total: 0
        };
        let people = ['–ï–≥–æ—Ä', '–î–∏–º–∞', '–°–∞–Ω—è'];

        // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π —Ç–µ–º—ã
        function updateThemeIndicator() {
            const indicator = document.getElementById('themeIndicator');
            const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;
            
            if (isDarkMode) {
                indicator.textContent = 'üåô –¢–µ–º–Ω–∞—è —Ç–µ–º–∞';
            } else {
                indicator.textContent = '‚òÄÔ∏è –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞';
            }
        }

        // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–µ–º—ã —Å–∏—Å—Ç–µ–º—ã
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', updateThemeIndicator);

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ü–≤–µ—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
		function generateColorFromName(name) {
			let hash = 0;
			for (let i = 0; i < name.length; i++) {
				hash = name.charCodeAt(i) + ((hash << 5) - hash);
			}
			
			// –ó–µ–º–ª–∏—Å—Ç—ã–µ —Ç–æ–Ω–∞ (–æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω hue)
			const hue = 20 + (Math.abs(hash) % 60); // 20-80¬∞ (—Ç–µ–ø–ª—ã–µ —Ç–æ–Ω–∞)
			const saturation = 30 + (Math.abs(hash) % 30); // 30-60%
			const lightness = 50 + (Math.abs(hash) % 30); // 50-80%
			
			return `hsl(${hue}, ${saturation}%, ${lightness}%)`;
		}


        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–µ—Ä–≤–æ–π –±—É–∫–≤—ã –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
        function getFirstLetter(name) {
            if (!name || name.length === 0) return '–ê';
            return name.charAt(0).toUpperCase();
        }

        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.classList.remove('hidden');
        }

        function hideError() {
            document.getElementById('error').classList.add('hidden');
        }

        function parsePrice(priceStr) {
            // –£–±–∏—Ä–∞–µ–º –≤—Å–µ –ª–∏—à–Ω–∏–µ —Å–∏–º–≤–æ–ª—ã –∏ –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã –∏ —Ç–æ—á–∫—É/–∑–∞–ø—è—Ç—É—é
            const cleanStr = priceStr.replace(/[^\d.,]/g, '');
            // –ó–∞–º–µ–Ω—è–µ–º –∑–∞–ø—è—Ç—É—é –Ω–∞ —Ç–æ—á–∫—É –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞
            const normalizedStr = cleanStr.replace(',', '.');
            return parseFloat(normalizedStr) || 0;
        }

        function formatPrice(price) {
            return price % 1 === 0 ? price.toString() : price.toFixed(2);
        }

        function copySummaryToClipboard() {
            const summaryData = generateSummaryText();
            
            if (navigator.clipboard && window.isSecureContext) {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º Clipboard API –¥–ª—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
                navigator.clipboard.writeText(summaryData).then(() => {
                    showCopyNotification();
                }).catch(err => {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏: ', err);
                    fallbackCopyTextToClipboard(summaryData);
                });
            } else {
                // Fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
                fallbackCopyTextToClipboard(summaryData);
            }
        }

        function fallbackCopyTextToClipboard(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showCopyNotification();
                } else {
                    console.error('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç');
                }
            } catch (err) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏: ', err);
            }
            
            document.body.removeChild(textArea);
        }


		function showCopyNotification(text = '‚úÖ –†–∞—Å—á–µ—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω') {
			const notification = document.getElementById('copyNotification');
			notification.textContent = text;
			notification.classList.add('show');
			
			setTimeout(() => {
				notification.classList.remove('show');
			}, 1000);
		}


		function copyPersonSummary(personName) {
			const summary = generatePersonSummaryText(personName);
			
			if (navigator.clipboard) {
				navigator.clipboard.writeText(summary).then(() => {
					showCopyNotification();
				});
			} else {
				fallbackCopyTextToClipboard(summary);
			}
		}

		function generatePersonSummaryText(personName) {
			// –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ generateSummaryText, –Ω–æ —Ç–æ–ª—å–∫–æ –¥–ª—è –æ–¥–Ω–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞
			const summary = {};
			summary[personName] = {
				items: [],
				total: 0
			};

			// –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —ç—Ç–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞
			const checkboxes = document.querySelectorAll(`input[data-person="${personName}"]:checked`);
			
			checkboxes.forEach(checkbox => {
				const itemIndex = checkbox.dataset.itemIndex;
				const item = orderData.items[itemIndex];
				
				if (item) {
					summary[personName].items.push({
						name: item.name,
						price: item.price,
						isShared: false
					});
					summary[personName].total += item.price;
				}
			});

			// –î–æ–±–∞–≤–ª—è–µ–º –¥–æ–ª—é –≤ –¥–æ—Å—Ç–∞–≤–∫–µ
			const additionalCosts = orderData.deliveryCost + orderData.serviceFee;
			const costPerPerson = additionalCosts / people.length;
			
			if (summary[personName].items.length > 0) {
				summary[personName].total += costPerPerson;
				summary[personName].items.push({
					name: '–î–æ—Å—Ç–∞–≤–∫–∞ –∏ —Å–µ—Ä–≤–∏—Å–Ω—ã–π —Å–±–æ—Ä',
					price: costPerPerson,
					isShared: true
				});
			}

			// –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç
			let summaryText = `üçï –†–ê–°–ß–ï–¢ –î–õ–Ø ${personName.toUpperCase()}\n`;
			summaryText += '='.repeat(30) + '\n\n';
			
			summary[personName].items.forEach(item => {
				const priceStr = formatPrice(item.price) + ' ‚ÇΩ';
				const suffix = item.isShared ? ' (—Ä–∞–∑–¥–µ–ª–µ–Ω–æ)' : '';
				summaryText += `‚Ä¢ ${item.name}: ${priceStr}${suffix}\n`;
			});
			
			summaryText += `\nüí∞ –ö –¥–æ–ø–ª–∞—Ç–µ: ${formatPrice(summary[personName].total)} ‚ÇΩ`;

			return summaryText;
		}

        function generateSummaryText() {
            const summary = {};
            people.forEach(person => {
                summary[person] = {
                    items: [],
                    total: 0
                };
            });

            // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —á–µ–∫–±–æ–∫—Å—ã
            const allCheckboxes = document.querySelectorAll('input[type="checkbox"]:checked');
            
            // –î–ª—è –∫–∞–∂–¥–æ–≥–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —á–µ–∫–±–æ–∫—Å–∞ –¥–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Ç–æ–≤–∞—Ä
            allCheckboxes.forEach(checkbox => {
                const person = checkbox.dataset.person;
                const itemIndex = checkbox.dataset.itemIndex;
                const item = orderData.items[itemIndex];
                
                if (item) {
                    summary[person].items.push({
                        name: item.name,
                        price: item.price,
                        isShared: false
                    });
                    summary[person].total += item.price;
                }
            });

            // –î–æ–±–∞–≤–ª—è–µ–º –¥–æ—Å—Ç–∞–≤–∫—É –∏ —Å–±–æ—Ä—ã, —Ä–∞–∑–¥–µ–ª–µ–Ω–Ω—ã–µ –ø–æ—Ä–æ–≤–Ω—É
            const additionalCosts = orderData.deliveryCost + orderData.serviceFee;
            const costPerPerson = additionalCosts / people.length;
            
            people.forEach(person => {
                if (summary[person].items.length > 0) {
                    summary[person].total += costPerPerson;
                    summary[person].items.push({
                        name: '–î–æ—Å—Ç–∞–≤–∫–∞ –∏ —Å–µ—Ä–≤–∏—Å–Ω—ã–π —Å–±–æ—Ä',
                        price: costPerPerson,
                        isShared: true
                    });
                }
            });

            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
            let summaryText = 'üçï –ò–¢–û–ì–û–í–´–ô –†–ê–°–ß–ï–¢ –ó–ê–ö–ê–ó–ê\n';
            summaryText += '=' + '='.repeat(30) + '\n\n';

            let totalSum = 0;
            people.forEach(person => {
                const personSummary = summary[person];
                if (personSummary.items.length === 0) return;
                
                summaryText += `üë§ ${person.toUpperCase()}\n`;
                summaryText += '-'.repeat(20) + '\n';
                
                personSummary.items.forEach(item => {
                    const priceStr = formatPrice(item.price) + ' ‚ÇΩ';
                    const suffix = item.isShared ? ' (—Ä–∞–∑–¥–µ–ª–µ–Ω–æ)' : '';
                    summaryText += `‚Ä¢ ${item.name}: ${priceStr}${suffix}\n`;
                });
                
                summaryText += `\nüí∞ –ö –¥–æ–ø–ª–∞—Ç–µ: ${formatPrice(personSummary.total)} ‚ÇΩ\n\n`;
                totalSum += personSummary.total;
            });

            summaryText += '=' + '='.repeat(30) + '\n';
            summaryText += `üßæ –û–ë–©–ê–Ø –°–£–ú–ú–ê: ${formatPrice(totalSum)} ‚ÇΩ\n`;
            summaryText += `üì¶ –î–æ—Å—Ç–∞–≤–∫–∞ –∏ —Å–±–æ—Ä—ã: ${formatPrice(additionalCosts)} ‚ÇΩ\n`;
            summaryText += `üçî –°—Ç–æ–∏–º–æ—Å—Ç—å –µ–¥—ã: ${formatPrice(totalSum - additionalCosts)} ‚ÇΩ`;

            return summaryText;
        }

        function parseOrder() {
            const text = document.getElementById('orderText').value.trim();
            hideError();

            if (!text) {
                showError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∑–∞–∫–∞–∑–∞');
                return;
            }

            if (!text.includes('–°–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞')) {
                showError('–¢–µ–∫—Å—Ç –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å "–°–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞"');
                return;
            }

            if (!text.match(/–ò—Ç–æ–≥–æ\s+[\d.,]+\s*‚ÇΩ/)) {
                showError('–¢–µ–∫—Å—Ç –¥–æ–ª–∂–µ–Ω –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å—Å—è "–ò—Ç–æ–≥–æ XXX ‚ÇΩ"');
                return;
            }

            try {
                // –ü–∞—Ä—Å–∏–º –ø–æ–∑–∏—Ü–∏–∏
                const items = [];
                const lines = text.split('\n').map(line => line.trim()).filter(line => line);
                let parsingItems = false;
                
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i];
                    
                    if (line === '–°–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞') {
                        parsingItems = true;
                        continue;
                    }
                    
                    if (line.includes('–î–æ—Å—Ç–∞–≤–∫–∞ –∏ –æ–ø–ª–∞—Ç–∞') || line.includes('–°—Ç–æ–∏–º–æ—Å—Ç—å —Ç–æ–≤–∞—Ä–æ–≤')) {
                        parsingItems = false;
                        continue;
                    }
                    
                    if (parsingItems) {
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ –Ω–∞–∑–≤–∞–Ω–∏–µ–º –±–ª—é–¥–∞ (–Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç "‚ÇΩ" –∏ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Å—Ç—Ä–æ–∫–æ–π —Ç–æ–ª—å–∫–æ –∏–∑ —Ü–∏—Ñ—Ä/–ø—Ä–æ–±–µ–ª–æ–≤)
                        if (!line.includes('‚ÇΩ') && !line.match(/^[\d.,\s]+$/) && 
                            (i + 1 < lines.length && lines[i + 1].includes('—à—Ç'))) {
                            
                            const itemName = line;
                            let quantity = 1;
                            let price = 0;
                            
                            // –°–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä–æ–∫–∞ - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
                            if (i + 1 < lines.length && lines[i + 1].includes('—à—Ç')) {
                                const qtyMatch = lines[i + 1].match(/(\d+)\s*—à—Ç/);
                                if (qtyMatch) {
                                    quantity = parseInt(qtyMatch[1]);
                                }
                                i++; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å—Ç—Ä–æ–∫—É —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º
                            }
                            
                            // –ò—â–µ–º —Ü–µ–Ω—É –≤ —Å–ª–µ–¥—É—é—â–∏—Ö —Å—Ç—Ä–æ–∫–∞—Ö
                            for (let j = i + 1; j < Math.min(i + 4, lines.length); j++) {
                                if (lines[j].includes('‚ÇΩ')) {
                                    // –°–Ω–∞—á–∞–ª–∞ –∏—â–µ–º —Ü–µ–Ω—É –∑–∞ —à—Ç—É–∫—É
                                    const unitPriceMatch = lines[j].match(/([\d.,]+)\s*‚ÇΩ\/\s*—à—Ç/);
                                    if (unitPriceMatch) {
                                        price = parsePrice(unitPriceMatch[1]);
                                        break;
                                    }
                                    
                                    // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ —Ü–µ–Ω—É –∑–∞ —à—Ç—É–∫—É, –∏—â–µ–º –æ–±—ã—á–Ω—É—é —Ü–µ–Ω—É
                                    const priceMatch = lines[j].match(/([\d.,]+)\s*‚ÇΩ/);
                                    if (priceMatch) {
                                        price = parsePrice(priceMatch[1]);
                                        // –ï—Å–ª–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–æ–ª—å—à–µ 1, –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º —á—Ç–æ —ç—Ç–æ –æ–±—â–∞—è —Ü–µ–Ω–∞
                                        if (quantity > 1) {
                                            price = price / quantity;
                                        }
                                        break;
                                    }
                                }
                            }
                            
                            if (price > 0) {
                                for (let k = 0; k < quantity; k++) {
                                    items.push({
                                        name: itemName,
                                        price: price,
                                        id: items.length + k,
                                        letter: getFirstLetter(itemName),
                                        color: generateColorFromName(itemName)
                                    });
                                }
                            }
                        }
                    }
                }

                // –ü–∞—Ä—Å–∏–º –¥–æ—Å—Ç–∞–≤–∫—É –∏ —Å–±–æ—Ä—ã
                let deliveryCost = 0;
                let serviceFee = 0;
                let total = 0;

                const deliveryMatch = text.match(/–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏\s+([\d.,]+)\s*‚ÇΩ/);
                if (deliveryMatch) {
                    deliveryCost = parsePrice(deliveryMatch[1]);
                }

                const serviceMatch = text.match(/–°–µ—Ä–≤–∏—Å–Ω—ã–π —Å–±–æ—Ä\s+([\d.,]+)\s*‚ÇΩ/);
                if (serviceMatch) {
                    serviceFee = parsePrice(serviceMatch[1]);
                }

                const totalMatch = text.match(/–ò—Ç–æ–≥–æ\s+([\d.,]+)\s*‚ÇΩ/);
                if (totalMatch) {
                    total = parsePrice(totalMatch[1]);
                }

                orderData = {
                    items: items,
                    deliveryCost: deliveryCost,
                    serviceFee: serviceFee,
                    total: total
                };

                if (items.length === 0) {
                    showError('–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –ø–æ–∑–∏—Ü–∏–∏ –≤ –∑–∞–∫–∞–∑–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç —Ç–µ–∫—Å—Ç–∞.');
                    return;
                }

                console.log('Parsed items:', items); // –î–æ–±–∞–≤–∏–º –ª–æ–≥ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
                document.getElementById('peopleSection').classList.remove('hidden');
                updateItemsDisplay();
                
            } catch (error) {
                showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞–∫–∞–∑–∞: ' + error.message);
                console.error(error);
            }
        }

        function handlePersonKeyPress(event) {
            if (event.key === 'Enter') {
                addPerson();
            }
        }

        function addPerson() {
            const input = document.getElementById('personName');
            const name = input.value.trim();
            
            if (!name) return;
            
            if (people.includes(name)) {
                showError('–£—á–∞—Å—Ç–Ω–∏–∫ —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω');
                return;
            }
            
            people.push(name);
            input.value = '';
            updatePeopleDisplay();
            updateItemsDisplay();
            hideError();
        }

        function removePerson(name) {
            people = people.filter(p => p !== name);
            updatePeopleDisplay();
            updateItemsDisplay();
            updateSummary();
        }

        function updatePeopleDisplay() {
            const container = document.getElementById('peopleList');
            container.innerHTML = people.map(person => `
                <div class="person-tag">
                    ${person}
                    <button class="remove-person" onclick="removePerson('${person}')">√ó</button>
                </div>
            `).join('');
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∏ —Ç–µ–º—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            updatePeopleDisplay();
            updateThemeIndicator();
        });

        function updateItemsDisplay() {
            if (people.length === 0 || orderData.items.length === 0) {
                document.getElementById('itemsSection').classList.add('hidden');
                document.getElementById('summary').classList.add('hidden');
                return;
            }

            const container = document.getElementById('itemsList');
            container.innerHTML = orderData.items.map((item, index) => {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —á–µ–∫–±–æ–∫—Å—ã –¥–ª—è —ç—Ç–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
                const checkboxes = document.querySelectorAll(`input[data-item-index="${index}"]`);
                let selectedPeople = [];
                checkboxes.forEach(cb => {
                    if (cb.checked) selectedPeople.push(cb.dataset.person);
                });

                return `
                    <div class="item-card">
                        <div class="item-header">
                            <div class="item-info">
                                <div class="item-image" style="background: ${item.color};">
                                    ${item.letter}
                                </div>
                                <div class="item-details">
                                    <div class="item-name">${item.name}</div>
                                </div>
                            </div>
                            <div class="item-price">${formatPrice(item.price)} ‚ÇΩ</div>
                        </div>
                        <div class="person-checkboxes">
                            ${people.map(person => {
                                const isChecked = selectedPeople.includes(person);
                                return `
                                    <label class="checkbox-wrapper ${isChecked ? 'checked' : ''}">
                                        <input type="checkbox" onchange="updateSummary()" 
                                               data-item-index="${index}" 
                                               data-person="${person}"
                                               ${isChecked ? 'checked' : ''}>
                                        ${person}
                                    </label>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('itemsSection').classList.remove('hidden');
            updateSummary();
        }

        function updateSummary() {
            if (people.length === 0) {
                document.getElementById('summary').classList.add('hidden');
                return;
            }

            const summary = {};
            people.forEach(person => {
                summary[person] = {
                    items: [],
                    total: 0
                };
            });

            // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —á–µ–∫–±–æ–∫—Å—ã
            const allCheckboxes = document.querySelectorAll('input[type="checkbox"]:checked');
            
            // –î–ª—è –∫–∞–∂–¥–æ–≥–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —á–µ–∫–±–æ–∫—Å–∞ –¥–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Ç–æ–≤–∞—Ä
            allCheckboxes.forEach(checkbox => {
                const person = checkbox.dataset.person;
                const itemIndex = checkbox.dataset.itemIndex;
                const item = orderData.items[itemIndex];
                
                if (item) {
                    // –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ–≤–∞—Ä —Å –ø–æ–ª–Ω–æ–π —Ü–µ–Ω–æ–π
                    summary[person].items.push({
                        name: item.name,
                        price: item.price,
                        isShared: false
                    });
                    summary[person].total += item.price;
                }
            });

            // –î–æ–±–∞–≤–ª—è–µ–º –¥–æ—Å—Ç–∞–≤–∫—É –∏ —Å–±–æ—Ä—ã, —Ä–∞–∑–¥–µ–ª–µ–Ω–Ω—ã–µ –ø–æ—Ä–æ–≤–Ω—É
            const additionalCosts = orderData.deliveryCost + orderData.serviceFee;
            const costPerPerson = additionalCosts / people.length;
            
            people.forEach(person => {
                if (summary[person].items.length > 0) { // –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ —É —á–µ–ª–æ–≤–µ–∫–∞ –µ—Å—Ç—å –∑–∞–∫–∞–∑—ã
                    summary[person].total += costPerPerson;
                    summary[person].items.push({
                        name: '–î–æ—Å—Ç–∞–≤–∫–∞ –∏ —Å–µ—Ä–≤–∏—Å–Ω—ã–π —Å–±–æ—Ä',
                        price: costPerPerson,
                        isShared: true
                    });
                }
            });

            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∏—Ç–æ–≥–∏
            const summaryContent = document.getElementById('summaryContent');
            summaryContent.innerHTML = people.map(person => {
                const personSummary = summary[person];
                if (personSummary.items.length === 0) return ''; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ª—é–¥–µ–π –±–µ–∑ –∑–∞–∫–∞–∑–æ–≤
                
                return `
                    <div class="person-summary">
					<div class="person-name">
						${person}
						<svg class="copy-icon" onclick="copyPersonSummary('${person}')" viewBox="0 0 24 24">
							<path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/>
						</svg>
					</div>
                        <div class="person-items">
                            ${personSummary.items.map(item => `
                                ${item.name}: ${formatPrice(item.price)} ‚ÇΩ${item.isShared ? ' (—Ä–∞–∑–¥–µ–ª–µ–Ω–æ)' : ''}
                            `).join('<br>')}
                        </div>
                        <div class="person-total">–ò—Ç–æ–≥–æ: ${formatPrice(personSummary.total)} ‚ÇΩ</div>
                    </div>
                `;
            }).join('');

            document.getElementById('summary').classList.remove('hidden');
        }
    </script>
